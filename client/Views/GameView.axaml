<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:client.ViewModels"
             xmlns:m="clr-namespace:client.Models"
             x:DataType="vm:GameViewModel"
             x:Class="client.Views.GameView">
  <Grid ColumnDefinitions="*,220" Margin="16">
    <Grid Grid.Column="0" RowDefinitions="Auto,Auto,Auto">
    <StackPanel>
      <TextBlock Text="ÐœÐ¾Ñ€ÑÐºÐ¾Ð¹ Ð±Ð¾Ð¹" FontSize="20" FontWeight="Bold" Margin="0,0,0,4"/>
      <TextBlock Text="{Binding Status}" Margin="0,0,0,4"/>
      <TextBlock Text="{Binding TurnSecondsLeft, StringFormat='Ð’Ñ€ÐµÐ¼Ñ Ð½Ð° Ñ…Ð¾Ð´: {0} ÑÐµÐº'}" 
                 Margin="0,0,0,8" 
                 IsVisible="{Binding IsMyTurn}"
                 FontWeight="Bold"/>
    </StackPanel>

    <!-- Ð”Ð²Ð° Ð¿Ð¾Ð»Ñ â€” Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð±Ð»Ð¾Ðº Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð³Ð¾ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð°, Ð½Ðµ Ñ€Ð°ÑÑ‚ÑÐ³Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð¿Ð¾ Ð¾ÐºÐ½Ñƒ -->
    <Grid Grid.Row="1" ColumnDefinitions="Auto,16,Auto"
          VerticalAlignment="Top" HorizontalAlignment="Left" Margin="0,8,0,0">
      <!-- ÐœÐ¾Ñ‘ Ð¿Ð¾Ð»Ðµ: ÑÐ²Ð¾Ð¸ ÐºÐ¾Ñ€Ð°Ð±Ð»Ð¸ Ð¸ Ð¾Ñ‚Ð¼ÐµÑ‚ÐºÐ¸ Ð²Ñ‹ÑÑ‚Ñ€ÐµÐ»Ð¾Ð² Ð¿Ñ€Ð¾Ñ‚Ð¸Ð²Ð½Ð¸ÐºÐ° -->
      <StackPanel Grid.Column="0">
        <TextBlock Text="ÐœÐ¾Ñ‘ Ð¿Ð¾Ð»Ðµ" FontWeight="Bold" Margin="0,0,0,4"/>
        <Border Width="190" Height="190" BorderBrush="Gray" BorderThickness="1" Padding="0">
          <ItemsControl ItemsSource="{Binding MyBoardCells}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <UniformGrid Rows="10" Columns="10"/>
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="vm:GameCellViewModel">
                <Border Width="19" Height="19" Margin="0"
                        BorderBrush="Gray" BorderThickness="1"
                        Background="{Binding CellBackground}"/>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </Border>
      </StackPanel>

      <!-- ÐŸÐ¾Ð»Ðµ Ð¿Ñ€Ð¾Ñ‚Ð¸Ð²Ð½Ð¸ÐºÐ°: Ð²Ñ‹ÑÑ‚Ñ€ÐµÐ»Ñ‹ Ð¿Ð¾ Ð²Ñ€Ð°Ð³Ñƒ (ÐºÐ»Ð¸Ðº â€” Ð²Ñ‹ÑÑ‚Ñ€ÐµÐ» Ð¿Ñ€Ð¸ ÑÐ²Ð¾Ñ‘Ð¼ Ñ…Ð¾Ð´Ðµ) -->
      <StackPanel Grid.Column="2">
        <TextBlock Text="ÐŸÐ¾Ð»Ðµ Ð¿Ñ€Ð¾Ñ‚Ð¸Ð²Ð½Ð¸ÐºÐ°" FontWeight="Bold" Margin="0,0,0,4"/>
        <Border Width="190" Height="190" BorderBrush="Gray" BorderThickness="1" Padding="0">
          <ItemsControl ItemsSource="{Binding EnemyBoardCells}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <UniformGrid Rows="10" Columns="10"/>
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="vm:GameCellViewModel">
                <Border Width="19" Height="19" Margin="0"
                        BorderBrush="Gray" BorderThickness="1"
                        Background="{Binding CellBackground}">
                  <Button Background="Transparent" BorderThickness="0"
                          Command="{Binding ShootCommand}"
                          CommandParameter="{Binding}"/>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </Border>
      </StackPanel>
    </Grid>

    <!-- Ð­ÐºÑ€Ð°Ð½ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð¸Ð³Ñ€Ñ‹ -->
    <Grid Grid.Row="2" Grid.Column="0" Margin="0,16,0,0" IsVisible="{Binding GameResultVisible}">
      <Border Background="White" BorderBrush="Black" BorderThickness="2" CornerRadius="8" Padding="16">
        <StackPanel Spacing="16" VerticalAlignment="Center" HorizontalAlignment="Center">
          <TextBlock Text="{Binding GameResult}" FontSize="18" FontWeight="Bold" TextAlignment="Center"/>
          
          <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° "ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð¸Ð³Ñ€Ñƒ" Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ ÑÑ‚Ð¾ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ -->
          <Button Content="ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð¸Ð³Ñ€Ñƒ" 
                  Command="{Binding PlayAgainCommand}"
                  Padding="16,8"
                  Background="Blue"
                  Foreground="White"
                  HorizontalAlignment="Center"
                  IsVisible="{Binding CanPlayAgain}"
                  IsEnabled="{Binding CanRequestPlayAgain}"/>

          <Button Content="Ð’ Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ"
                  Command="{Binding GoToMainMenuCommand}"
                  Padding="16,8"
                  Background="Gray"
                  Foreground="White"
                  HorizontalAlignment="Center"/>

          <TextBlock Text="{Binding PostGameInfo}"
                     FontSize="12"
                     TextAlignment="Center"
                     Foreground="Gray"/>
        </StackPanel>
      </Border>
    </Grid>
    </Grid>

    <!-- Ð§Ð°Ñ‚ Ñ ÑÐ¾Ð¿ÐµÑ€Ð½Ð¸ÐºÐ¾Ð¼ -->
    <Border Grid.Column="1" Margin="16,0,0,0" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="6" Padding="8"
            MinWidth="200" MaxWidth="220" VerticalAlignment="Stretch">
      <Grid RowDefinitions="Auto,*,Auto">
        <TextBlock Text="ðŸ’¬ Ð§Ð°Ñ‚" FontWeight="Bold" FontSize="14" Margin="0,0,0,6"/>
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,0,0,6">
          <ItemsControl ItemsSource="{Binding ChatMessages}">
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="m:ChatMessageItem">
                <Border Margin="0,2" Padding="6,4" CornerRadius="4" MaxWidth="180">
                  <StackPanel>
                    <TextBlock Text="{Binding Sender}" FontSize="10" FontWeight="SemiBold" Opacity="0.9"/>
                    <TextBlock Text="{Binding Text}" FontSize="12" TextWrapping="Wrap"/>
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>
        <Grid Grid.Row="2" ColumnDefinitions="*,Auto">
          <TextBox Grid.Column="0" Text="{Binding ChatText}" Watermark="Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ..."
                   Margin="0,0,6,0" MaxHeight="32"/>
          <Button Grid.Column="1" Content="âž¤" Command="{Binding SendChatCommand}" Width="36"/>
        </Grid>
      </Grid>
    </Border>
  </Grid>
</UserControl>
